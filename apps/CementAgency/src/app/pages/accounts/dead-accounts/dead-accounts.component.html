<div class="dead-accounts-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <h2 class="page-title">
        <i class="fas fa-user-times"></i>
        Dead Accounts Management
      </h2>
      <div class="header-actions">
        <button class="btn btn-outline-primary" (click)="refresh()" [disabled]="loading">
          <i class="fas fa-sync-alt"></i>
          Refresh
        </button>
      </div>
    </div>
  </div>

  <!-- Search and Filter Section -->
  <div class="search-section">
    <div class="row">
      <div class="col-md-6">
        <div class="search-box">
          <div class="input-group">
            <div class="input-group-prepend">
              <span class="input-group-text">
                <i class="fas fa-search"></i>
              </span>
            </div>
            <input 
              type="text" 
              class="form-control" 
              placeholder="Search by account name, code, contact person, or city..." 
              [(ngModel)]="searchTerm"
              (input)="onSearch()"
            >
            <div class="input-group-append" *ngIf="searchTerm">
              <button class="btn btn-outline-secondary" type="button" (click)="clearSearch()">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="results-info">
          <span class="badge badge-secondary">
            Total Records: {{totalItems}}
          </span>
          <span class="badge badge-info ml-2">
            Page {{currentPage}} of {{totalPages}}
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Data Table Section -->
  <div class="table-section">
    <div class="card">
      <div class="card-body">
        <!-- Loading Spinner -->
        <div *ngIf="loading" class="text-center p-4">
          <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Loading...</span>
          </div>
          <p class="mt-2 text-muted">Loading dead accounts...</p>
        </div>

        <!-- No Data Found -->
        <div *ngIf="!loading && filteredAccounts.length === 0" class="text-center p-4">
          <div class="empty-state">
            <i class="fas fa-user-check fa-3x text-success mb-3"></i>
            <h5>No Dead Accounts Found</h5>
            <p class="text-muted">
              <span *ngIf="searchTerm">No accounts match your search criteria.</span>
              <span *ngIf="!searchTerm">All accounts are currently active!</span>
            </p>
            <button *ngIf="searchTerm" class="btn btn-outline-primary" (click)="clearSearch()">
              Clear Search
            </button>
          </div>
        </div>

        <!-- Data Table -->
        <div *ngIf="!loading && filteredAccounts.length > 0" class="table-responsive">
          <table class="table table-striped table-hover">
            <thead class="thead-dark">
              <tr>
                <th scope="col">#</th>
                <th scope="col">Code</th>
                <th scope="col">Account Name</th>
                <th scope="col">Contact Person</th>
                <th scope="col">City</th>
                <th scope="col">Phone</th>
                <th scope="col">Balance</th>
                <th scope="col">Status</th>
                <th scope="col" class="text-center">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let account of paginatedAccounts; let i = index">
                <th scope="row">{{(currentPage - 1) * itemsPerPage + i + 1}}</th>
                <td>
                  <span class="account-code">{{account.AccountCode || 'N/A'}}</span>
                </td>
                <td>
                  <div class="account-info">
                    <strong>{{account.AccountName}}</strong>
                    <br>
                    <small class="text-muted" *ngIf="account.Email">{{account.Email}}</small>
                  </div>
                </td>
                <td>{{account.ContactPerson || 'N/A'}}</td>
                <td>{{account.City || 'N/A'}}</td>
                <td>
                  <div *ngIf="account.PhoneNo || account.MobileNo">
                    <div *ngIf="account.PhoneNo">ðŸ“ž {{account.PhoneNo}}</div>
                    <div *ngIf="account.MobileNo">ðŸ“± {{account.MobileNo}}</div>
                  </div>
                  <span *ngIf="!account.PhoneNo && !account.MobileNo" class="text-muted">N/A</span>
                </td>
                <td>
                  <span [ngClass]="{
                    'text-success': account.Balance > 0,
                    'text-danger': account.Balance < 0,
                    'text-muted': account.Balance === 0
                  }">
                    {{account.Balance | currency:'PKR':'symbol':'1.2-2'}}
                  </span>
                </td>
                <td>
                  <span class="badge" [ngClass]="{
                    'badge-danger': account.Status === 'Dead',
                    'badge-warning': account.Status === 'Inactive',
                    'badge-secondary': account.Status === 'Closed'
                  }">
                    {{account.Status}}
                  </span>
                </td>
                <td class="text-center">
                  <div class="btn-group" role="group">
                    <!-- View Details Button -->
                    <button 
                      type="button" 
                      class="btn btn-sm btn-outline-info" 
                      (click)="viewAccountDetails(account)"
                      title="View Details"
                    >
                      <i class="fas fa-eye"></i>
                    </button>
                    
                    <!-- Reactivate Button -->
                    <button 
                      type="button" 
                      class="btn btn-sm btn-outline-success" 
                      (click)="reactivateAccount(account)"
                      title="Reactivate Account"
                    >
                      <i class="fas fa-user-check"></i>
                    </button>
                    
                    <!-- Delete Button -->
                    <button 
                      type="button" 
                      class="btn btn-sm btn-outline-danger" 
                      (click)="deleteAccount(account)"
                      title="Delete Permanently"
                    >
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination Section -->
  <div *ngIf="!loading && filteredAccounts.length > 0" class="pagination-section">
    <nav aria-label="Accounts pagination">
      <div class="row align-items-center">
        <div class="col-md-6">
          <div class="pagination-info">
            Showing {{(currentPage - 1) * itemsPerPage + 1}} to 
            {{Math.min(currentPage * itemsPerPage, totalItems)}} of 
            {{totalItems}} entries
          </div>
        </div>
        <div class="col-md-6">
          <div class="pagination-controls">
            <div class="btn-group" role="group">
              <button 
                class="btn btn-outline-primary btn-sm" 
                [disabled]="currentPage === 1" 
                (click)="goToPage(1)"
              >
                First
              </button>
              <button 
                class="btn btn-outline-primary btn-sm" 
                [disabled]="currentPage === 1" 
                (click)="previousPage()"
              >
                <i class="fas fa-chevron-left"></i>
              </button>
              
              <span class="btn btn-primary btn-sm disabled">
                {{currentPage}} / {{totalPages}}
              </span>
              
              <button 
                class="btn btn-outline-primary btn-sm" 
                [disabled]="currentPage === totalPages" 
                (click)="nextPage()"
              >
                <i class="fas fa-chevron-right"></i>
              </button>
              <button 
                class="btn btn-outline-primary btn-sm" 
                [disabled]="currentPage === totalPages" 
                (click)="goToPage(totalPages)"
              >
                Last
              </button>
            </div>
          </div>
        </div>
      </div>
    </nav>
  </div>

  <!-- Statistics Card -->
  <div *ngIf="!loading && deadAccounts.length > 0" class="statistics-section mt-4">
    <div class="row">
      <div class="col-md-3">
        <div class="card text-white bg-danger">
          <div class="card-body">
            <div class="d-flex justify-content-between">
              <div>
                <h4>{{deadAccounts.filter(a => a.Status === 'Dead').length}}</h4>
                <small>Dead Accounts</small>
              </div>
              <div class="align-self-center">
                <i class="fas fa-user-times fa-2x"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-white bg-warning">
          <div class="card-body">
            <div class="d-flex justify-content-between">
              <div>
                <h4>{{deadAccounts.filter(a => a.Status === 'Inactive').length}}</h4>
                <small>Inactive Accounts</small>
              </div>
              <div class="align-self-center">
                <i class="fas fa-user-clock fa-2x"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-white bg-secondary">
          <div class="card-body">
            <div class="d-flex justify-content-between">
              <div>
                <h4>{{deadAccounts.filter(a => a.Status === 'Closed').length}}</h4>
                <small>Closed Accounts</small>
              </div>
              <div class="align-self-center">
                <i class="fas fa-user-slash fa-2x"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-white bg-info">
          <div class="card-body">
            <div class="d-flex justify-content-between">
              <div>
                <h4>{{deadAccounts.reduce((sum, a) => sum + a.Balance, 0) | currency:'PKR':'symbol':'1.0-0'}}</h4>
                <small>Total Balance</small>
              </div>
              <div class="align-self-center">
                <i class="fas fa-dollar-sign fa-2x"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>